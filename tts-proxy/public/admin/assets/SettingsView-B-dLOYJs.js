import{s as $,j,k as p,d as B,o as P,a as q,w as D,e as t,i as H,f as v,g as F,u as C,F as N,b as d,l as w,t as g,n as T,p as K,x as O}from"./index-QCUBHikX.js";import{_ as L}from"./AppLayout.vue_vue_type_script_setup_true_lang-BitsU6QT.js";import{E as S}from"./index-BVP15cf-.js";import{u as R}from"./engines-CeXHXfJ0.js";const z=$("settings",()=>{const x=j(),o=p({}),y=p(!1),l=p(null),i=p(!1);async function h(){y.value=!0,l.value=null;try{const r=await fetch("/admin/api/settings/credentials",{headers:x.getHeaders()});if(r.ok){const u=await r.json();o.value=u.credentials||{}}else l.value="Failed to fetch credentials"}catch{l.value="Connection error"}finally{y.value=!1}}async function m(r,u){i.value=!0,l.value=null;try{const c=await fetch(`/admin/api/settings/credentials/${r}`,{method:"PUT",headers:x.getHeaders(!0),body:JSON.stringify({credentials:u})});if(c.ok)return o.value[r]=u,!0;{const b=await c.json();return l.value=b.error||"Failed to save credentials",!1}}catch{return l.value="Connection error",!1}finally{i.value=!1}}async function k(r){try{const c=await(await fetch(`/admin/api/settings/credentials/${r}/test`,{method:"POST",headers:x.getHeaders()})).json();return{valid:c.valid,message:c.message}}catch{return{valid:!1,message:"Connection error"}}}function _(r){return S[r]?.keyFields||[]}function E(r){const u=o.value[r];return u?_(r).every(b=>u[b]&&u[b].length>0):!1}return{credentials:o,isLoading:y,error:l,isSaving:i,fetchCredentials:h,saveCredentials:m,testCredentials:k,getCredentialFields:_,hasCredentials:E}}),A={class:"space-y-6"},G={class:"space-y-4"},J={key:0,class:"bg-white rounded-lg shadow overflow-hidden"},M=["onClick"],U={class:"flex items-center gap-4"},Y={class:"font-medium text-gray-900"},Q={class:"text-sm text-gray-500"},W={class:"flex items-center gap-3"},X={class:"text-gray-400"},Z={key:0,class:"border-t border-gray-200 p-4 bg-gray-50"},I={class:"space-y-4"},ee={class:"block text-sm font-medium text-gray-700 mb-1"},te=["value","onInput","placeholder"],se={class:"flex gap-3 pt-2"},ae=["onClick","disabled"],re=["onClick","disabled"],le={class:"bg-gray-50 rounded-lg p-4"},ne={class:"flex flex-wrap gap-2"},de=B({__name:"SettingsView",setup(x){const o=z(),y=R(),l=p(null),i=p({}),h=p({}),m=p(null);P(async()=>{await Promise.all([o.fetchCredentials(),y.fetchEnginesStatus()])});function k(e){if(l.value===e)l.value=null;else{l.value=e;const a=S[e]?.keyFields||[];i.value[e]||(i.value[e]={}),a.forEach(n=>{i.value[e][n]=o.credentials[e]?.[n]||""})}}function _(e,a){return i.value[e]?.[a]||""}function E(e,a,n){i.value[e]||(i.value[e]={}),i.value[e][a]=n}async function r(e){const a=i.value[e]||{};await o.saveCredentials(e,a)&&(l.value=null,await y.fetchEnginesStatus())}async function u(e){m.value=e;const a=await o.testCredentials(e);h.value[e]=a,m.value=null}function c(e){return y.engines[e]}function b(e){return o.hasCredentials(e)}return(e,a)=>(d(),q(L,null,{default:D(()=>[t("div",A,[a[1]||(a[1]=t("div",null,[t("h2",{class:"text-2xl font-bold text-gray-900"},"Settings"),t("p",{class:"text-gray-600 mt-1"},"Configure system-wide TTS engine credentials")],-1)),a[2]||(a[2]=t("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[t("p",{class:"text-blue-800"},[t("strong",null,"ðŸ’¡ Credentials Priority:"),H(" System credentials can be set here or via environment variables. Values saved here will override environment variables and persist in the database. ")])],-1)),t("div",G,[(d(!0),v(N,null,F(C(S),(n,s)=>(d(),v("div",{key:s},[n.requiresKey?(d(),v("div",J,[t("div",{class:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50",onClick:f=>k(s)},[t("div",U,[t("div",null,[t("div",Y,g(n.name),1),t("div",Q,g(n.description),1)])]),t("div",W,[c(s)?(d(),v("span",{key:0,class:T([c(s)?.valid?"bg-green-100 text-green-800":"bg-red-100 text-red-800","text-xs px-2 py-1 rounded"])},g(c(s)?.valid?"âœ“ Valid":"âœ— Invalid"),3)):w("",!0),t("span",{class:T([b(s)?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600","text-xs px-2 py-1 rounded"])},g(b(s)?"Configured":"Not Configured"),3),t("span",X,g(l.value===s?"â–²":"â–¼"),1)])],8,M),l.value===s?(d(),v("div",Z,[t("div",I,[(d(!0),v(N,null,F(n.keyFields,f=>(d(),v("div",{key:f},[t("label",ee,g(f),1),t("input",{type:"password",value:_(s,f),onInput:V=>E(s,f,V.target.value),placeholder:f.includes("KEY")?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢":"Enter value",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,40,te)]))),128)),h.value[s]?(d(),v("div",{key:0,class:T(["p-3 rounded-lg",h.value[s]?.valid?"bg-green-50 text-green-800":"bg-red-50 text-red-800"])},g(h.value[s]?.message),3)):w("",!0),t("div",se,[t("button",{onClick:f=>u(s),disabled:m.value===s,class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50"},g(m.value===s?"Testing...":"Test Credentials"),9,ae),t("button",{onClick:f=>r(s),disabled:C(o).isSaving,class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50"},g(C(o).isSaving?"Saving...":"Save Credentials"),9,re)])])])):w("",!0)])):w("",!0)]))),128))]),t("div",le,[a[0]||(a[0]=t("h3",{class:"font-medium text-gray-900 mb-2"},"Free Engines (No Credentials Required)",-1)),t("div",ne,[(d(!0),v(N,null,F(C(S),(n,s)=>K((d(),v("span",{key:s,class:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm"},g(n.name),1)),[[O,!n.requiresKey]])),128))])])])]),_:1}))}});export{de as default};
